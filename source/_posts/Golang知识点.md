---
title: Golang知识点
date: 2020-07-17 16:32:55
tags:
---
### 代码规范

- 减少对象分配：所谓减少对象的分配，实际上是尽量做到，对象的重用

**RWMutex的使用主要事项**

**1、读锁的时候无需等待读锁的结束**

**2、读锁的时候要等待写锁的结束**

**3、写锁的时候要等待读锁的结束**

**4、写锁的时候要等待写锁的结束**

闭包

闭包里引用了不作为参数传递进去的值,都是引用传递

https://studygolang.com/articles/13253?fr=sidebar

Log4go

输出字符中带``\r \n` 无法打印完全，将其转正json即可

defer是在return之前执行的。这个在 [官方文档](http://golang.org/ref/spec#defer_statements)中是明确说明了的。要使用defer时不踩坑，最重要的一点就是要明白，**return xxx这一条语句并不是一条原子指令!**

函数返回的过程是这样的：先给返回值赋值，然后调用defer表达式，最后才是返回到调用函数中。

### gc调优

启动 GODEBUG=gctrace=1 go run main.go

[https://studygolang.com/articles/9641](https://studygolang.com/articles/9641)

圾回收信息`gc 1 @2.104s 0%: 0.018+1.3+0.076 ms clock, 0.054+0.35/1.0/3.0+0.23 ms cpu, 4->4->3 MB, 5 MB goal, 4 P`。

`1` 表示第一次执行`@2.104s` 表示程序执行的总时间`0%` 垃圾回收时间占用的百分比，（不知道和谁比？难道是和上面的程序执行总时间，这样比较感觉没意义）`0.018+1.3+0.076 ms clock` 垃圾回收的时间，分别为STW（stop-the-world）清扫的时间, 并发标记和扫描的时间，STW标记的时间`0.054+0.35/1.0/3.0+0.23 ms cpu` 垃圾回收占用cpu时间`4->4->3 MB` 堆的大小，gc后堆的大小，存活堆的大小`5 MB goal` 整体堆的大小`4 P` 使用的处理器数量

系统内存回收信息,这个很直白，看单词就知道大概意思了`scvg0: inuse: 426, idle: 0, sys: 427, released: 0, consumed: 427 (MB)`

`426` 使用多少M内存`0` 剩下要清除的内存`427` 系统映射的内存`0` 释放的系统内存`427` 申请的系统内存
